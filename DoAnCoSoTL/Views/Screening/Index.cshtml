
@model List<DoAnCoSoTL.Models.Screening>


<h2>Choose Cinema and Showtime:</h2>
@foreach (var cinemaGroup in Model.GroupBy(s => s.CinemaId))
{
    <h3>@cinemaGroup.First().Cinema.Name</h3> <!-- Tiêu đề là tên của rạp chiếu phim -->
    @foreach (var dateGroup in cinemaGroup.GroupBy(s => s.Date))
    {
        <div>
            <h4>Date: @dateGroup.Key.ToShortDateString()</h4>
            @foreach (var timeSlot in GetTimeSlots(dateGroup))
            {
                <form asp-controller="Seat" asp-action="Choose" method="get">
                    <input type="hidden" name="screeningId" value="@dateGroup.First().Id" />
                    <input type="hidden" name="timeSlot" value="@timeSlot" />
                    <button type="submit" class="btn btn-primary">@timeSlot</button>
                </form>
            }
        </div>
    }
}

@functions {
    public List<string> GetTimeSlots(IEnumerable<DoAnCoSoTL.Models.Screening> screenings)
    {
        // Tạo danh sách các khung giờ từ danh sách lịch chiếu screenings
        List<string> timeSlots = new List<string>();

        // Gộp thời gian bắt đầu và kết thúc của các lịch chiếu cùng ngày vào một hàng
        var timeSlotsGrouped = screenings.GroupBy(s => $"{s.Time} - {s.EndTime}");
        foreach (var timeSlotGroup in timeSlotsGrouped)
        {
            timeSlots.Add(timeSlotGroup.Key);
        }

        return timeSlots;
    }
}
<h1>List of Screenings</h1>

@foreach (var screening in Model)
{
    <div>
        <h4>@screening.Movie.Name</h4>
        <p>Date: @screening.Date.ToShortDateString()</p>
        <p>Time: @screening.Time - @screening.EndTime</p>
        <p>Cinema: @screening.Cinema.Name</p>
        <a asp-action="Details" asp-route-id="@screening.Id">Select Screening</a>
    </div>
} 
@*  @{
    var today = DateTime.Today;
    var screeningsToday = Model.Where(s => s.Date.Date == today);
}

@if (screeningsToday.Any())
{
    <h1>List of Screenings Today</h1>
    @foreach (var screening in screeningsToday)
    {
        <div>
            <h4>@screening.Movie.Name</h4>
            <p>Date: @screening.Date.ToShortDateString()</p>
            <p>Time: @screening.Time - @screening.EndTime</p>
            <p>Cinema: @screening.Cinema.Name</p>
            <a asp-action="Details" asp-route-id="@screening.Id">Select Screening</a>
        </div>
    }
}
else
{
    <h1>No Screenings Today</h1>
} 



@* @{
    var today = DateTime.Today;
    var endDate = Model.Max(s => s.Date); // Lấy ngày kết thúc của lịch chiếu
}

<h2>Choose Cinema and Showtime:</h2>

@for (var date = today; date <= endDate; date = date.AddDays(1))
{
    <div>
        <h3>Date: @date.ToShortDateString()</h3>
        @if (Model.Any(s => s.Date.Date == date.Date))
        {
            <form asp-action="ChooseSeat">
                @foreach (var screening in Model.Where(s => s.Date.Date == date.Date))
                {
                    <button type="submit" class="btn btn-primary" name="screeningId" value="@screening.Id">@screening.Time - @screening.EndTime</button>
                }
            </form>
        }
        else
        {
            <p>No screenings available for this date.</p>
        }
    </div>
} *@
